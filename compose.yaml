services:
  api:
    image: ghcr.io/payetonkawa-epsi-2025/orders/paye-ton-kawa--orders
    container_name: orders-api
    environment:
      - DATABASE_DSN=postgres://postgresadmin:postgresadmin@database:5432/orders
      - RABBIT_DSN=amqp://guest:guest@rabbit:5672
    ports:
      - 8082:8082
    networks:
      - default
      - tpre814_network
    labels:
      - "traefik.enable=true"
      - "traefik.http.routers.orders.rule=Host(`orders.localhost`)"
      - "traefik.http.routers.orders.entrypoints=web"
      - "traefik.http.services.orders.loadbalancer.server.port=8082"
  database:
    image: postgres:17.4-alpine
    environment:
      POSTGRES_USER: postgresadmin
      POSTGRES_PASSWORD: postgresadmin
      POSTGRES_DB: orders
    volumes:
      - db_data:/var/lib/postgresql/data
    ports:
      - 5432:5432

volumes:
  db_data:

networks:
  tpre814_network:
    external: true
    name: TPRE814
